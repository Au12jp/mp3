"use strict";(()=>{var Z=Object.defineProperty;var b=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var x=e=>{throw TypeError(e)};var tt=(e,t,r)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var C=(e,t)=>{var r={};for(var o in e)q.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&b)for(var o of b(e))t.indexOf(o)<0&&Q.call(e,o)&&(r[o]=e[o]);return r};var m=(e,t)=>()=>(e&&(t=e(e=0)),t);var et=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var E=(e,t,r)=>tt(e,typeof t!="symbol"?t+"":t,r),S=(e,t,r)=>t.has(e)||x("Cannot "+r);var a=(e,t,r)=>(S(e,t,"read from private field"),r?r.call(e):t.get(e)),h=(e,t,r)=>t.has(e)?x("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),I=(e,t,r,o)=>(S(e,t,"write to private field"),o?o.call(e,r):t.set(e,r),r);var u=(e,t,r)=>new Promise((o,s)=>{var i=R=>{try{d(r.next(R))}catch(D){s(D)}},p=R=>{try{d(r.throw(R))}catch(D){s(D)}},d=R=>R.done?o(R.value):Promise.resolve(R.value).then(i,p);d((r=r.apply(e,t)).next())});var rt,Et,n,M=m(()=>{rt="0.12.6",Et=`https://unpkg.com/@ffmpeg/core@${rt}/dist/umd/ffmpeg-core.js`;(function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"})(n||(n={}))});var P,k=m(()=>{P=(()=>{let e=0;return()=>e++})()});var Rt,B,v,ft,j=m(()=>{Rt=new Error("unknown message type"),B=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),v=new Error("called FFmpeg.terminate()"),ft=new Error("failed to import ffmpeg-core.js")});var W,f,w,l,L,O,U,c,A,G=m(()=>{M();k();j();W={},A=class{constructor(){h(this,f,null);h(this,w,{});h(this,l,{});h(this,L,[]);h(this,O,[]);E(this,"loaded",!1);h(this,U,()=>{a(this,f)&&(a(this,f).onmessage=({data:{id:t,type:r,data:o}})=>{switch(r){case n.LOAD:this.loaded=!0,a(this,w)[t](o);break;case n.MOUNT:case n.UNMOUNT:case n.EXEC:case n.WRITE_FILE:case n.READ_FILE:case n.DELETE_FILE:case n.RENAME:case n.CREATE_DIR:case n.LIST_DIR:case n.DELETE_DIR:a(this,w)[t](o);break;case n.LOG:a(this,L).forEach(s=>s(o));break;case n.PROGRESS:a(this,O).forEach(s=>s(o));break;case n.ERROR:a(this,l)[t](o);break}delete a(this,w)[t],delete a(this,l)[t]})});h(this,c,({type:t,data:r},o=[],s)=>a(this,f)?new Promise((i,p)=>{let d=P();a(this,f)&&a(this,f).postMessage({id:d,type:t,data:r},o),a(this,w)[d]=i,a(this,l)[d]=p,s==null||s.addEventListener("abort",()=>{p(new DOMException(`Message # ${d} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(B));E(this,"load",(s={},{signal:o}={})=>{var i=s,{classWorkerURL:t}=i,r=C(i,["classWorkerURL"]);return a(this,f)||(I(this,f,t?new Worker(new URL(t,W.url),{type:"module"}):new Worker(new URL("./worker.js",W.url),{type:"module"})),a(this,U).call(this)),a(this,c).call(this,{type:n.LOAD,data:r},void 0,o)});E(this,"exec",(t,r=-1,{signal:o}={})=>a(this,c).call(this,{type:n.EXEC,data:{args:t,timeout:r}},void 0,o));E(this,"terminate",()=>{let t=Object.keys(a(this,l));for(let r of t)a(this,l)[r](v),delete a(this,l)[r],delete a(this,w)[r];a(this,f)&&(a(this,f).terminate(),I(this,f,null),this.loaded=!1)});E(this,"writeFile",(t,r,{signal:o}={})=>{let s=[];return r instanceof Uint8Array&&s.push(r.buffer),a(this,c).call(this,{type:n.WRITE_FILE,data:{path:t,data:r}},s,o)});E(this,"mount",(t,r,o)=>{let s=[];return a(this,c).call(this,{type:n.MOUNT,data:{fsType:t,options:r,mountPoint:o}},s)});E(this,"unmount",t=>{let r=[];return a(this,c).call(this,{type:n.UNMOUNT,data:{mountPoint:t}},r)});E(this,"readFile",(t,r="binary",{signal:o}={})=>a(this,c).call(this,{type:n.READ_FILE,data:{path:t,encoding:r}},void 0,o));E(this,"deleteFile",(t,{signal:r}={})=>a(this,c).call(this,{type:n.DELETE_FILE,data:{path:t}},void 0,r));E(this,"rename",(t,r,{signal:o}={})=>a(this,c).call(this,{type:n.RENAME,data:{oldPath:t,newPath:r}},void 0,o));E(this,"createDir",(t,{signal:r}={})=>a(this,c).call(this,{type:n.CREATE_DIR,data:{path:t}},void 0,r));E(this,"listDir",(t,{signal:r}={})=>a(this,c).call(this,{type:n.LIST_DIR,data:{path:t}},void 0,r));E(this,"deleteDir",(t,{signal:r}={})=>a(this,c).call(this,{type:n.DELETE_DIR,data:{path:t}},void 0,r))}on(t,r){t==="log"?a(this,L).push(r):t==="progress"&&a(this,O).push(r)}off(t,r){t==="log"?I(this,L,a(this,L).filter(o=>o!==r)):t==="progress"&&I(this,O,a(this,O).filter(o=>o!==r))}};f=new WeakMap,w=new WeakMap,l=new WeakMap,L=new WeakMap,O=new WeakMap,U=new WeakMap,c=new WeakMap});var $=m(()=>{G()});var Y,F,H=m(()=>{Y=new Error("failed to get response body reader"),F=new Error("failed to complete download")});var V,X=m(()=>{V="Content-Length"});var ot,z,at,g,J=m(()=>{H();X();ot=e=>new Promise((t,r)=>{let o=new FileReader;o.onload=()=>{let{result:s}=o;s instanceof ArrayBuffer?t(new Uint8Array(s)):t(new Uint8Array)},o.onerror=s=>{var i,p;r(Error(`File could not be read! Code=${((p=(i=s==null?void 0:s.target)==null?void 0:i.error)==null?void 0:p.code)||-1}`))},o.readAsArrayBuffer(e)}),z=e=>u(void 0,null,function*(){let t;if(typeof e=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(r=>r.charCodeAt(0)):t=yield(yield fetch(e)).arrayBuffer();else if(e instanceof URL)t=yield(yield fetch(e)).arrayBuffer();else if(e instanceof File||e instanceof Blob)t=yield ot(e);else return new Uint8Array;return new Uint8Array(t)}),at=(e,t)=>u(void 0,null,function*(){var s;let r=yield fetch(e),o;try{let i=parseInt(r.headers.get(V)||"-1"),p=(s=r.body)==null?void 0:s.getReader();if(!p)throw Y;let d=[],R=0;for(;;){let{done:_,value:y}=yield p.read(),N=y?y.length:0;if(_){if(i!=-1&&i!==R)throw F;t&&t({url:e,total:i,received:R,delta:N,done:_});break}d.push(y),R+=N,t&&t({url:e,total:i,received:R,delta:N,done:_})}let D=new Uint8Array(R),T=0;for(let _ of d)D.set(_,T),T+=_.length;o=D.buffer}catch(i){console.log("failed to send download progress event: ",i),o=yield r.arrayBuffer(),t&&t({url:e,total:o.byteLength,received:o.byteLength,delta:0,done:!0})}return o}),g=(e,t,r=!1,o)=>u(void 0,null,function*(){let s=r?yield at(e,o):yield(yield fetch(e)).arrayBuffer(),i=new Blob([s],{type:t});return URL.createObjectURL(i)})});var nt=et(K=>{$();J();self.addEventListener("message",e=>u(K,null,function*(){let{command:t,file:r,startTime:o,endTime:s}=e.data;if(t==="trim"){let i=yield st(r,o,s);self.postMessage({trimmedVideoUrl:i})}}));function st(e,t,r){return u(this,null,function*(){let o=new A,s="./core-mt";yield o.load({coreURL:yield g(`${s}/ffmpeg-core.js`,"text/javascript"),wasmURL:yield g(`${s}/ffmpeg-core.wasm`,"application/wasm"),workerURL:yield g(`${s}/ffmpeg-core.worker.js`,"text/javascript")}),yield o.writeFile("input.mp4",yield z(e));let i=(parseInt(r)-parseInt(t)).toString();yield o.exec(["-i","input.mp4","-ss",t,"-t",i,"output.mp4"]);let p=yield o.readFile("output.mp4"),d=new Blob([new Uint8Array(p)],{type:"video/mp4"});return URL.createObjectURL(d)})}});nt();})();
//# sourceMappingURL=worker.js.map
