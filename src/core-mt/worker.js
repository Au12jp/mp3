"use strict";(()=>{var v=Object.defineProperty;var x=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var U=t=>{throw TypeError(t)};var Y=(t,e,r)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var b=(t,e)=>{var r={};for(var s in t)$.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&x)for(var s of x(t))e.indexOf(s)<0&&G.call(t,s)&&(r[s]=t[s]);return r};var d=(t,e,r)=>Y(t,typeof e!="symbol"?e+"":e,r),k=(t,e,r)=>e.has(t)||U("Cannot "+r);var a=(t,e,r)=>(k(t,e,"read from private field"),r?r.call(t):e.get(t)),g=(t,e,r)=>e.has(t)?U("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),A=(t,e,r,s)=>(k(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r);var R=(t,e,r)=>new Promise((s,n)=>{var i=c=>{try{f(r.next(c))}catch(O){n(O)}},p=c=>{try{f(r.throw(c))}catch(O){n(O)}},f=c=>c.done?s(c.value):Promise.resolve(c.value).then(i,p);f((r=r.apply(t,e)).next())});var H="0.12.6",q=`https://unpkg.com/@ffmpeg/core@${H}/dist/umd/ffmpeg-core.js`,o;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(o||(o={}));var F=(()=>{let t=0;return()=>t++})();var te=new Error("unknown message type"),C=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),S=new Error("called FFmpeg.terminate()"),re=new Error("failed to import ffmpeg-core.js");var W={};var E,h,u,w,L,y,l,I=class{constructor(){g(this,E,null);g(this,h,{});g(this,u,{});g(this,w,[]);g(this,L,[]);d(this,"loaded",!1);g(this,y,()=>{a(this,E)&&(a(this,E).onmessage=({data:{id:e,type:r,data:s}})=>{switch(r){case o.LOAD:this.loaded=!0,a(this,h)[e](s);break;case o.MOUNT:case o.UNMOUNT:case o.EXEC:case o.WRITE_FILE:case o.READ_FILE:case o.DELETE_FILE:case o.RENAME:case o.CREATE_DIR:case o.LIST_DIR:case o.DELETE_DIR:a(this,h)[e](s);break;case o.LOG:a(this,w).forEach(n=>n(s));break;case o.PROGRESS:a(this,L).forEach(n=>n(s));break;case o.ERROR:a(this,u)[e](s);break}delete a(this,h)[e],delete a(this,u)[e]})});g(this,l,({type:e,data:r},s=[],n)=>a(this,E)?new Promise((i,p)=>{let f=F();a(this,E)&&a(this,E).postMessage({id:f,type:e,data:r},s),a(this,h)[f]=i,a(this,u)[f]=p,n==null||n.addEventListener("abort",()=>{p(new DOMException(`Message # ${f} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(C));d(this,"load",(n={},{signal:s}={})=>{var i=n,{classWorkerURL:e}=i,r=b(i,["classWorkerURL"]);return a(this,E)||(A(this,E,e?new Worker(new URL(e,W.url),{type:"module"}):new Worker(new URL("./worker.js",W.url),{type:"module"})),a(this,y).call(this)),a(this,l).call(this,{type:o.LOAD,data:r},void 0,s)});d(this,"exec",(e,r=-1,{signal:s}={})=>a(this,l).call(this,{type:o.EXEC,data:{args:e,timeout:r}},void 0,s));d(this,"terminate",()=>{let e=Object.keys(a(this,u));for(let r of e)a(this,u)[r](S),delete a(this,u)[r],delete a(this,h)[r];a(this,E)&&(a(this,E).terminate(),A(this,E,null),this.loaded=!1)});d(this,"writeFile",(e,r,{signal:s}={})=>{let n=[];return r instanceof Uint8Array&&n.push(r.buffer),a(this,l).call(this,{type:o.WRITE_FILE,data:{path:e,data:r}},n,s)});d(this,"mount",(e,r,s)=>{let n=[];return a(this,l).call(this,{type:o.MOUNT,data:{fsType:e,options:r,mountPoint:s}},n)});d(this,"unmount",e=>{let r=[];return a(this,l).call(this,{type:o.UNMOUNT,data:{mountPoint:e}},r)});d(this,"readFile",(e,r="binary",{signal:s}={})=>a(this,l).call(this,{type:o.READ_FILE,data:{path:e,encoding:r}},void 0,s));d(this,"deleteFile",(e,{signal:r}={})=>a(this,l).call(this,{type:o.DELETE_FILE,data:{path:e}},void 0,r));d(this,"rename",(e,r,{signal:s}={})=>a(this,l).call(this,{type:o.RENAME,data:{oldPath:e,newPath:r}},void 0,s));d(this,"createDir",(e,{signal:r}={})=>a(this,l).call(this,{type:o.CREATE_DIR,data:{path:e}},void 0,r));d(this,"listDir",(e,{signal:r}={})=>a(this,l).call(this,{type:o.LIST_DIR,data:{path:e}},void 0,r));d(this,"deleteDir",(e,{signal:r}={})=>a(this,l).call(this,{type:o.DELETE_DIR,data:{path:e}},void 0,r))}on(e,r){e==="log"?a(this,w).push(r):e==="progress"&&a(this,L).push(r)}off(e,r){e==="log"?A(this,w,a(this,w).filter(s=>s!==r)):e==="progress"&&A(this,L,a(this,L).filter(s=>s!==r))}};E=new WeakMap,h=new WeakMap,u=new WeakMap,w=new WeakMap,L=new WeakMap,y=new WeakMap,l=new WeakMap;var P=new Error("failed to get response body reader"),j=new Error("failed to complete download");var B="Content-Length";var X=(t,e)=>R(void 0,null,function*(){var n;let r=yield fetch(t),s;try{let i=parseInt(r.headers.get(B)||"-1"),p=(n=r.body)==null?void 0:n.getReader();if(!p)throw P;let f=[],c=0;for(;;){let{done:D,value:T}=yield p.read(),M=T?T.length:0;if(D){if(i!=-1&&i!==c)throw j;e&&e({url:t,total:i,received:c,delta:M,done:D});break}f.push(T),c+=M,e&&e({url:t,total:i,received:c,delta:M,done:D})}let O=new Uint8Array(c),N=0;for(let D of f)O.set(D,N),N+=D.length;s=O.buffer}catch(i){console.log("failed to send download progress event: ",i),s=yield r.arrayBuffer(),e&&e({url:t,total:s.byteLength,received:s.byteLength,delta:0,done:!0})}return s}),_=(t,e,r=!1,s)=>R(void 0,null,function*(){let n=r?yield X(t,s):yield(yield fetch(t)).arrayBuffer(),i=new Blob([n],{type:e});return URL.createObjectURL(i)});var m=null;self.addEventListener("message",t=>R(void 0,null,function*(){let{command:e,args:r}=t.data;if(!m&&e!=="load"){self.postMessage({status:"error",message:"FFmpeg is not loaded."});return}switch(e){case"load":yield V();break;case"writeFile":yield z(r);break;case"readFile":yield J(r);break;case"run":yield K(r);break;default:console.error(`Unknown command: ${e}`)}}));function V(){return R(this,null,function*(){try{if(m===null){m=new I;let t=".",e={classWorkerURL:yield _(`${t}/worker.js`,"text/javascript"),coreURL:yield _(`${t}/ffmpeg-core.js`,"text/javascript"),wasmURL:yield _(`${t}/ffmpeg-core.wasm`,"application/wasm"),workerURL:yield _(`${t}/ffmpeg-core.worker.js`,"text/javascript")};yield m.load(e),self.postMessage({status:"loaded"})}else self.postMessage({status:"already-loaded"})}catch(t){self.postMessage({status:"error",message:t instanceof Error?t.message:String(t)})}})}function z(t){return R(this,null,function*(){try{m&&(yield m.writeFile(t.fileName,t.fileData),self.postMessage({status:"file-written"}))}catch(e){self.postMessage({status:"error",message:e instanceof Error?e.message:String(e)})}})}function J(t){return R(this,null,function*(){try{if(m){let e=yield m.readFile(t.fileName);self.postMessage({result:e})}}catch(e){self.postMessage({status:"error",message:e instanceof Error?e.message:String(e)})}})}function K(t){return R(this,null,function*(){try{if(m){let e=performance.now();console.log("Running FFmpeg with arguments:",t.commandArgs),m.on("progress",({progress:s,time:n})=>{let i=(performance.now()-e)/1e3,p=s*100,c=i/s-i;console.log(`Progress: ${Math.round(p)}%, Time Left: ${Math.round(c)}s`),self.postMessage({status:"progress",percent:Math.round(p),elapsedTime:Math.round(i),estimatedRemainingTime:Math.round(c)})});let r=yield m.exec(t.commandArgs);console.log("FFmpeg execution completed"),self.postMessage({status:"execution-completed",result:r})}}catch(e){console.error("Error during FFmpeg execution:",e),self.postMessage({status:"error",message:e instanceof Error?e.message:String(e)})}})}})();
//# sourceMappingURL=worker.js.map
