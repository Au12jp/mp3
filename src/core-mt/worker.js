"use strict";(()=>{var v=Object.defineProperty;var x=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var U=t=>{throw TypeError(t)};var Y=(t,e,r)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var b=(t,e)=>{var r={};for(var s in t)$.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&x)for(var s of x(t))e.indexOf(s)<0&&G.call(t,s)&&(r[s]=t[s]);return r};var c=(t,e,r)=>Y(t,typeof e!="symbol"?e+"":e,r),k=(t,e,r)=>e.has(t)||U("Cannot "+r);var a=(t,e,r)=>(k(t,e,"read from private field"),r?r.call(t):e.get(t)),h=(t,e,r)=>e.has(t)?U("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),A=(t,e,r,s)=>(k(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r);var R=(t,e,r)=>new Promise((s,n)=>{var i=E=>{try{l(r.next(E))}catch(O){n(O)}},u=E=>{try{l(r.throw(E))}catch(O){n(O)}},l=E=>E.done?s(E.value):Promise.resolve(E.value).then(i,u);l((r=r.apply(t,e)).next())});var H="0.12.6",q=`https://unpkg.com/@ffmpeg/core@${H}/dist/umd/ffmpeg-core.js`,o;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(o||(o={}));var C=(()=>{let t=0;return()=>t++})();var te=new Error("unknown message type"),F=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),S=new Error("called FFmpeg.terminate()"),re=new Error("failed to import ffmpeg-core.js");var W={};var f,g,p,w,L,y,d,I=class{constructor(){h(this,f,null);h(this,g,{});h(this,p,{});h(this,w,[]);h(this,L,[]);c(this,"loaded",!1);h(this,y,()=>{a(this,f)&&(a(this,f).onmessage=({data:{id:e,type:r,data:s}})=>{switch(r){case o.LOAD:this.loaded=!0,a(this,g)[e](s);break;case o.MOUNT:case o.UNMOUNT:case o.EXEC:case o.WRITE_FILE:case o.READ_FILE:case o.DELETE_FILE:case o.RENAME:case o.CREATE_DIR:case o.LIST_DIR:case o.DELETE_DIR:a(this,g)[e](s);break;case o.LOG:a(this,w).forEach(n=>n(s));break;case o.PROGRESS:a(this,L).forEach(n=>n(s));break;case o.ERROR:a(this,p)[e](s);break}delete a(this,g)[e],delete a(this,p)[e]})});h(this,d,({type:e,data:r},s=[],n)=>a(this,f)?new Promise((i,u)=>{let l=C();a(this,f)&&a(this,f).postMessage({id:l,type:e,data:r},s),a(this,g)[l]=i,a(this,p)[l]=u,n==null||n.addEventListener("abort",()=>{u(new DOMException(`Message # ${l} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(F));c(this,"load",(n={},{signal:s}={})=>{var i=n,{classWorkerURL:e}=i,r=b(i,["classWorkerURL"]);return a(this,f)||(A(this,f,e?new Worker(new URL(e,W.url),{type:"module"}):new Worker(new URL("./worker.js",W.url),{type:"module"})),a(this,y).call(this)),a(this,d).call(this,{type:o.LOAD,data:r},void 0,s)});c(this,"exec",(e,r=-1,{signal:s}={})=>a(this,d).call(this,{type:o.EXEC,data:{args:e,timeout:r}},void 0,s));c(this,"terminate",()=>{let e=Object.keys(a(this,p));for(let r of e)a(this,p)[r](S),delete a(this,p)[r],delete a(this,g)[r];a(this,f)&&(a(this,f).terminate(),A(this,f,null),this.loaded=!1)});c(this,"writeFile",(e,r,{signal:s}={})=>{let n=[];return r instanceof Uint8Array&&n.push(r.buffer),a(this,d).call(this,{type:o.WRITE_FILE,data:{path:e,data:r}},n,s)});c(this,"mount",(e,r,s)=>{let n=[];return a(this,d).call(this,{type:o.MOUNT,data:{fsType:e,options:r,mountPoint:s}},n)});c(this,"unmount",e=>{let r=[];return a(this,d).call(this,{type:o.UNMOUNT,data:{mountPoint:e}},r)});c(this,"readFile",(e,r="binary",{signal:s}={})=>a(this,d).call(this,{type:o.READ_FILE,data:{path:e,encoding:r}},void 0,s));c(this,"deleteFile",(e,{signal:r}={})=>a(this,d).call(this,{type:o.DELETE_FILE,data:{path:e}},void 0,r));c(this,"rename",(e,r,{signal:s}={})=>a(this,d).call(this,{type:o.RENAME,data:{oldPath:e,newPath:r}},void 0,s));c(this,"createDir",(e,{signal:r}={})=>a(this,d).call(this,{type:o.CREATE_DIR,data:{path:e}},void 0,r));c(this,"listDir",(e,{signal:r}={})=>a(this,d).call(this,{type:o.LIST_DIR,data:{path:e}},void 0,r));c(this,"deleteDir",(e,{signal:r}={})=>a(this,d).call(this,{type:o.DELETE_DIR,data:{path:e}},void 0,r))}on(e,r){e==="log"?a(this,w).push(r):e==="progress"&&a(this,L).push(r)}off(e,r){e==="log"?A(this,w,a(this,w).filter(s=>s!==r)):e==="progress"&&A(this,L,a(this,L).filter(s=>s!==r))}};f=new WeakMap,g=new WeakMap,p=new WeakMap,w=new WeakMap,L=new WeakMap,y=new WeakMap,d=new WeakMap;var P=new Error("failed to get response body reader"),j=new Error("failed to complete download");var B="Content-Length";var X=(t,e)=>R(void 0,null,function*(){var n;let r=yield fetch(t),s;try{let i=parseInt(r.headers.get(B)||"-1"),u=(n=r.body)==null?void 0:n.getReader();if(!u)throw P;let l=[],E=0;for(;;){let{done:D,value:T}=yield u.read(),N=T?T.length:0;if(D){if(i!=-1&&i!==E)throw j;e&&e({url:t,total:i,received:E,delta:N,done:D});break}l.push(T),E+=N,e&&e({url:t,total:i,received:E,delta:N,done:D})}let O=new Uint8Array(E),M=0;for(let D of l)O.set(D,M),M+=D.length;s=O.buffer}catch(i){console.log("failed to send download progress event: ",i),s=yield r.arrayBuffer(),e&&e({url:t,total:s.byteLength,received:s.byteLength,delta:0,done:!0})}return s}),_=(t,e,r=!1,s)=>R(void 0,null,function*(){let n=r?yield X(t,s):yield(yield fetch(t)).arrayBuffer(),i=new Blob([n],{type:e});return URL.createObjectURL(i)});var m=null;self.addEventListener("message",t=>R(void 0,null,function*(){let{command:e,args:r}=t.data;if(!m&&e!=="load"){self.postMessage({status:"error",message:"FFmpeg is not loaded."});return}switch(e){case"load":yield V();break;case"writeFile":yield z(r);break;case"readFile":yield J(r);break;case"run":yield K(r);break;default:console.error(`Unknown command: ${e}`)}}));function V(){return R(this,null,function*(){try{if(m===null){m=new I;let t="./core-mt",e={classWorkerURL:yield _(`${t}/worker.js`,"text/javascript"),coreURL:yield _(`${t}/ffmpeg-core.js`,"text/javascript"),wasmURL:yield _(`${t}/ffmpeg-core.wasm`,"application/wasm"),workerURL:yield _(`${t}/ffmpeg-core.worker.js`,"text/javascript")};yield m.load(e),self.postMessage({status:"loaded"})}else self.postMessage({status:"already-loaded"})}catch(t){self.postMessage({status:"error",message:t instanceof Error?t.message:String(t)})}})}function z(t){return R(this,null,function*(){try{m&&(yield m.writeFile(t.fileName,t.fileData),self.postMessage({status:"file-written"}))}catch(e){self.postMessage({status:"error",message:e instanceof Error?e.message:String(e)})}})}function J(t){return R(this,null,function*(){try{if(m){let e=yield m.readFile(t.fileName);self.postMessage({result:e})}}catch(e){self.postMessage({status:"error",message:e instanceof Error?e.message:String(e)})}})}function K(t){return R(this,null,function*(){try{if(m){let e=performance.now();m.on("progress",({progress:s})=>{let n=(performance.now()-e)/1e3,i=s*100,l=n/s-n;self.postMessage({status:"progress",percent:Math.round(i),elapsedTime:Math.round(n),estimatedRemainingTime:Math.round(l)})});let r=yield m.exec(t.commandArgs);self.postMessage({status:"execution-completed",result:r})}}catch(e){self.postMessage({status:"error",message:e instanceof Error?e.message:String(e)})}})}})();
//# sourceMappingURL=worker.js.map
