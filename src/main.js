"use strict";(()=>{var ze=Object.create;var Q=Object.defineProperty;var Ye=Object.getOwnPropertyDescriptor;var Je=Object.getOwnPropertyNames,W=Object.getOwnPropertySymbols,Ze=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var he=(t,i,n)=>i in t?Q(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n,V=(t,i)=>{for(var n in i||(i={}))X.call(i,n)&&he(t,n,i[n]);if(W)for(var n of W(i))de.call(i,n)&&he(t,n,i[n]);return t};var ge=(t,i)=>{var n={};for(var a in t)X.call(t,a)&&i.indexOf(a)<0&&(n[a]=t[a]);if(t!=null&&W)for(var a of W(t))i.indexOf(a)<0&&de.call(t,a)&&(n[a]=t[a]);return n};var L=(t,i)=>()=>(i||t((i={exports:{}}).exports,i),i.exports);var Ke=(t,i,n,a)=>{if(i&&typeof i=="object"||typeof i=="function")for(let c of Je(i))!X.call(t,c)&&c!==n&&Q(t,c,{get:()=>i[c],enumerable:!(a=Ye(i,c))||a.enumerable});return t};var Qe=(t,i,n)=>(n=t!=null?ze(Ze(t)):{},Ke(i||!t||!t.__esModule?Q(n,"default",{value:t,enumerable:!0}):n,t));var O=(t,i,n)=>new Promise((a,c)=>{var f=p=>{try{m(n.next(p))}catch(h){c(h)}},g=p=>{try{m(n.throw(p))}catch(h){c(h)}},m=p=>p.done?a(p.value):Promise.resolve(p.value).then(f,g);m((n=n.apply(t,i)).next())});var ve=L((Ft,te)=>{var ee=function(t){"use strict";var i=Object.prototype,n=i.hasOwnProperty,a=Object.defineProperty||function(r,e,o){r[e]=o.value},c,f=typeof Symbol=="function"?Symbol:{},g=f.iterator||"@@iterator",m=f.asyncIterator||"@@asyncIterator",p=f.toStringTag||"@@toStringTag";function h(r,e,o){return Object.defineProperty(r,e,{value:o,enumerable:!0,configurable:!0,writable:!0}),r[e]}try{h({},"")}catch(r){h=function(e,o,l){return e[o]=l}}function C(r,e,o,l){var s=e&&e.prototype instanceof N?e:N,u=Object.create(s.prototype),y=new J(l||[]);return a(u,"_invoke",{value:Ve(r,o,y)}),u}t.wrap=C;function q(r,e,o){try{return{type:"normal",arg:r.call(e,o)}}catch(l){return{type:"throw",arg:l}}}var R="suspendedStart",G="suspendedYield",T="executing",$="completed",F={};function N(){}function A(){}function P(){}var d={};h(d,g,function(){return this});var v=Object.getPrototypeOf,w=v&&v(v(Z([])));w&&w!==i&&n.call(w,g)&&(d=w);var j=P.prototype=N.prototype=Object.create(d);A.prototype=P,a(j,"constructor",{value:P,configurable:!0}),a(P,"constructor",{value:A,configurable:!0}),A.displayName=h(P,p,"GeneratorFunction");function S(r){["next","throw","return"].forEach(function(e){h(r,e,function(o){return this._invoke(e,o)})})}t.isGeneratorFunction=function(r){var e=typeof r=="function"&&r.constructor;return e?e===A||(e.displayName||e.name)==="GeneratorFunction":!1},t.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,P):(r.__proto__=P,h(r,p,"GeneratorFunction")),r.prototype=Object.create(j),r},t.awrap=function(r){return{__await:r}};function M(r,e){function o(u,y,b,k){var E=q(r[u],r,y);if(E.type==="throw")k(E.arg);else{var K=E.arg,I=K.value;return I&&typeof I=="object"&&n.call(I,"__await")?e.resolve(I.__await).then(function(_){o("next",_,b,k)},function(_){o("throw",_,b,k)}):e.resolve(I).then(function(_){K.value=_,b(K)},function(_){return o("throw",_,b,k)})}}var l;function s(u,y){function b(){return new e(function(k,E){o(u,y,k,E)})}return l=l?l.then(b,b):b()}a(this,"_invoke",{value:s})}S(M.prototype),h(M.prototype,m,function(){return this}),t.AsyncIterator=M,t.async=function(r,e,o,l,s){s===void 0&&(s=Promise);var u=new M(C(r,e,o,l),s);return t.isGeneratorFunction(e)?u:u.next().then(function(y){return y.done?y.value:u.next()})};function Ve(r,e,o){var l=R;return function(u,y){if(l===T)throw new Error("Generator is already running");if(l===$){if(u==="throw")throw y;return me()}for(o.method=u,o.arg=y;;){var b=o.delegate;if(b){var k=pe(b,o);if(k){if(k===F)continue;return k}}if(o.method==="next")o.sent=o._sent=o.arg;else if(o.method==="throw"){if(l===R)throw l=$,o.arg;o.dispatchException(o.arg)}else o.method==="return"&&o.abrupt("return",o.arg);l=T;var E=q(r,e,o);if(E.type==="normal"){if(l=o.done?$:G,E.arg===F)continue;return{value:E.arg,done:o.done}}else E.type==="throw"&&(l=$,o.method="throw",o.arg=E.arg)}}}function pe(r,e){var o=e.method,l=r.iterator[o];if(l===c)return e.delegate=null,o==="throw"&&r.iterator.return&&(e.method="return",e.arg=c,pe(r,e),e.method==="throw")||o!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+o+"' method")),F;var s=q(l,r.iterator,e.arg);if(s.type==="throw")return e.method="throw",e.arg=s.arg,e.delegate=null,F;var u=s.arg;if(!u)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,F;if(u.done)e[r.resultName]=u.value,e.next=r.nextLoc,e.method!=="return"&&(e.method="next",e.arg=c);else return u;return e.delegate=null,F}S(j),h(j,p,"Generator"),h(j,g,function(){return this}),h(j,"toString",function(){return"[object Generator]"});function He(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function Y(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function J(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(He,this),this.reset(!0)}t.keys=function(r){var e=Object(r),o=[];for(var l in e)o.push(l);return o.reverse(),function s(){for(;o.length;){var u=o.pop();if(u in e)return s.value=u,s.done=!1,s}return s.done=!0,s}};function Z(r){if(r){var e=r[g];if(e)return e.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var o=-1,l=function s(){for(;++o<r.length;)if(n.call(r,o))return s.value=r[o],s.done=!1,s;return s.value=c,s.done=!0,s};return l.next=l}}return{next:me}}t.values=Z;function me(){return{value:c,done:!0}}return J.prototype={constructor:J,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(Y),!r)for(var e in this)e.charAt(0)==="t"&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var r=this.tryEntries[0],e=r.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var e=this;function o(k,E){return u.type="throw",u.arg=r,e.next=k,E&&(e.method="next",e.arg=c),!!E}for(var l=this.tryEntries.length-1;l>=0;--l){var s=this.tryEntries[l],u=s.completion;if(s.tryLoc==="root")return o("end");if(s.tryLoc<=this.prev){var y=n.call(s,"catchLoc"),b=n.call(s,"finallyLoc");if(y&&b){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(y){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else if(b){if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,e){for(var o=this.tryEntries.length-1;o>=0;--o){var l=this.tryEntries[o];if(l.tryLoc<=this.prev&&n.call(l,"finallyLoc")&&this.prev<l.finallyLoc){var s=l;break}}s&&(r==="break"||r==="continue")&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var u=s?s.completion:{};return u.type=r,u.arg=e,s?(this.method="next",this.next=s.finallyLoc,F):this.complete(u)},complete:function(r,e){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&e&&(this.next=e),F},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.finallyLoc===r)return this.complete(o.completion,o.afterLoc),Y(o),F}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc===r){var l=o.completion;if(l.type==="throw"){var s=l.arg;Y(o)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(r,e,o){return this.delegate={iterator:Z(r),resultName:e,nextLoc:o},this.method==="next"&&(this.arg=c),F}},t}(typeof te=="object"?te.exports:{});try{regeneratorRuntime=ee}catch(t){typeof globalThis=="object"?globalThis.regeneratorRuntime=ee:Function("r","regeneratorRuntime = r")(ee)}});var ye=L((jt,we)=>{we.exports={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}}});var oe=L((kt,Ee)=>{var re=!1,be=()=>{},Xe=t=>{re=t},et=t=>{be=t},tt=(t,i)=>{be({type:t,message:i}),re&&console.log(`[${t}] ${i}`)};Ee.exports={logging:re,setLogging:Xe,setCustomLogger:et,log:tt}});var je=L((Pt,Fe)=>{var x=0,ne=0,Le=t=>{let[i,n,a]=t.split(":");return parseFloat(i)*60*60+parseFloat(n)*60+parseFloat(a)};Fe.exports=(t,i)=>{if(typeof t=="string")if(t.startsWith("  Duration")){let n=t.split(", ")[0].split(": ")[1],a=Le(n);i({duration:a,ratio:ne}),(x===0||x>a)&&(x=a)}else if(t.startsWith("frame")||t.startsWith("size")){let n=t.split("time=")[1].split(" ")[0],a=Le(n);ne=a/x,i({ratio:ne,time:a})}else t.startsWith("video:")&&(i({ratio:1}),x=0)}});var Pe=L((St,ke)=>{ke.exports=(t,i)=>{let n=t._malloc(i.length*Uint32Array.BYTES_PER_ELEMENT);return i.forEach((a,c)=>{let f=t._malloc(a.length+1);t.writeAsciiToMemory(a,f),t.setValue(n+Uint32Array.BYTES_PER_ELEMENT*c,f,"i32")}),[i.length,n]}});var H=L((ie,Se)=>{(function(t,i){typeof define=="function"&&define.amd?define(i):typeof ie=="object"?Se.exports=i():t.resolveUrl=i()})(ie,function(){function t(){var i=arguments.length;if(i===0)throw new Error("resolveUrl requires at least one argument; got none.");var n=document.createElement("base");if(n.href=arguments[0],i===1)return n.href;var a=document.getElementsByTagName("head")[0];a.insertBefore(n,a.firstChild);for(var c=document.createElement("a"),f,g=1;g<i;g++)c.href=arguments[g],f=c.href,n.href=f;return a.removeChild(n),f}return t})});var ae=L((Ot,rt)=>{rt.exports={name:"@ffmpeg/ffmpeg",version:"0.10.1",description:"FFmpeg WebAssembly version",main:"src/index.js",types:"src/index.d.ts",directories:{example:"examples"},scripts:{start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},browser:{"./src/node/index.js":"./src/browser/index.js"},repository:{type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},keywords:["ffmpeg","WebAssembly","video"],author:"Jerome Wu <jeromewus@gmail.com>",license:"MIT",bugs:{url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},engines:{node:">=12.16.1"},homepage:"https://github.com/ffmpegwasm/ffmpeg.wasm#readme",dependencies:{"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},devDependencies:{"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.10.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"}}});var Ce=L((qt,Oe)=>{var Ct=H(),{devDependencies:ot}=ae();Oe.exports={corePath:`https://unpkg.com/@ffmpeg/core@${ot["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`}});var _e=L((ce,qe)=>{var nt=H(),{log:D}=oe(),se=(t,i)=>O(ce,null,function*(){D("info",`fetch ${t}`);let n=yield(yield fetch(t)).arrayBuffer();D("info",`${t} file size = ${n.byteLength} bytes`);let a=new Blob([n],{type:i}),c=URL.createObjectURL(a);return D("info",`${t} blob URL = ${c}`),c});qe.exports=i=>O(ce,[i],function*({corePath:t}){if(typeof t!="string")throw Error("corePath should be a string!");let n=nt(t),a=yield se(n,"application/javascript"),c=yield se(n.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),f=yield se(n.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore=="undefined"?new Promise(g=>{let m=document.createElement("script"),p=()=>{m.removeEventListener("load",p),D("info","ffmpeg-core.js script loaded"),g({createFFmpegCore,corePath:a,wasmPath:c,workerPath:f})};m.src=a,m.type="text/javascript",m.addEventListener("load",p),document.getElementsByTagName("head")[0].appendChild(m)}):(D("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:a,wasmPath:c,workerPath:f}))})});var Re=L((Be,Ue)=>{var it=H(),at=t=>new Promise((i,n)=>{let a=new FileReader;a.onload=()=>{i(a.result)},a.onerror=({target:{error:{code:c}}})=>{n(Error(`File could not be read! Code=${c}`))},a.readAsArrayBuffer(t)});Ue.exports=t=>O(Be,null,function*(){let i=t;return typeof t=="undefined"?new Uint8Array:(typeof t=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?i=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):i=yield(yield fetch(it(t))).arrayBuffer():(t instanceof File||t instanceof Blob)&&(i=yield at(t)),new Uint8Array(i))})});var le=L((Ut,Te)=>{var st=Ce(),ct=_e(),lt=Re();Te.exports={defaultOptions:st,getCreateFFmpegCore:ct,fetchFile:lt}});var Ne=L((Me,Ge)=>{var{defaultArgs:ft,baseOptions:ut}=ye(),{setLogging:$e,setCustomLogger:Ae,log:B}=oe(),pt=je(),mt=Pe(),{defaultOptions:ht,getCreateFFmpegCore:dt}=le(),{version:gt}=ae(),fe=Error("ffmpeg.wasm is not ready, make sure you have completed load().");Ge.exports=(t={})=>{let P=V(V(V({},ut),ht),t),{log:i,logger:n,progress:a}=P,c=ge(P,["log","logger","progress"]),f=null,g=null,m=null,p=!1,h=a,C=d=>{d==="FFMPEG_END"&&m!==null&&(m(),m=null,p=!1)},q=({type:d,message:v})=>{B(d,v),pt(v,h),C(v)},R=()=>O(Me,null,function*(){if(B("info","load ffmpeg-core"),f===null){B("info","loading ffmpeg-core");let{createFFmpegCore:d,corePath:v,workerPath:w,wasmPath:j}=yield dt(c);f=yield d({mainScriptUrlOrBlob:v,printErr:S=>q({type:"fferr",message:S}),print:S=>q({type:"ffout",message:S}),locateFile:(S,M)=>{if(typeof window!="undefined"){if(typeof j!="undefined"&&S.endsWith("ffmpeg-core.wasm"))return j;if(typeof w!="undefined"&&S.endsWith("ffmpeg-core.worker.js"))return w}return M+S}}),g=f.cwrap("proxy_main","number",["number","number"]),B("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")}),G=()=>f!==null,T=(...d)=>{if(B("info",`run ffmpeg command: ${d.join(" ")}`),f===null)throw fe;if(p)throw Error("ffmpeg.wasm can only run one command at a time");return p=!0,new Promise(v=>{let w=[...ft,...d].filter(j=>j.length!==0);m=v,g(...mt(f,w))})},$=(d,...v)=>{if(B("info",`run FS.${d} ${v.map(w=>typeof w=="string"?w:`<${w.length} bytes binary file>`).join(" ")}`),f===null)throw fe;{let w=null;try{w=f.FS[d](...v)}catch(j){throw Error(d==="readdir"?`ffmpeg.FS('readdir', '${v[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:d==="readFile"?`ffmpeg.FS('readFile', '${v[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return w}},F=()=>{if(f===null)throw fe;p=!1,f.exit(1),f=null,g=null,m=null},N=d=>{h=d},A=d=>{Ae(d)};return $e(i),Ae(n),B("info",`use ffmpeg.wasm v${gt}`),{setProgress:N,setLogger:A,setLogging:$e,load:R,isLoaded:G,run:T,exit:F,FS:$}}});var xe=L((Tt,Ie)=>{ve();var vt=Ne(),{fetchFile:wt}=le();Ie.exports={createFFmpeg:vt,fetchFile:wt}});var Et=L(We=>{var z=Qe(xe()),U=(0,z.createFFmpeg)({log:!0}),De=document.getElementById("fileInput"),yt=document.getElementById("convertButton"),ue=document.getElementById("output");yt.addEventListener("click",()=>O(We,null,function*(){var n;if(!((n=De.files)!=null&&n.length)){alert("Please select an mp3 file.");return}let t=De.files[0];ue.textContent="Processing...",U.isLoaded()||(yield U.load()),U.FS("writeFile","input.mp3",yield(0,z.fetchFile)(t));let i="";U.setLogger(({type:a,message:c})=>{(a==="fferr"||a==="ffout")&&(i+=c+`
`)});try{yield U.run("-i","input.mp3","-filter_complex","[0:a]astats=metadata=1:reset=1,showspectrum=s=320x720:mode=combined","-f","null","-");let a=i.split(`
`),c=[];a.forEach(p=>{if(p.includes("Parsed_astats")){let h=p.match(/t:(\d+\.\d+)/),C=p.match(/mean_volume:([-]?\d+\.\d+)/),q=p.match(/peak_volume:([-]?\d+\.\d+)/);if(h&&C&&q){let R=parseFloat(h[1]),G=parseFloat(C[1]),T=parseFloat(q[1]);c.push(`Time: ${R}s, Mean Volume: ${G}dB, Peak Volume: ${T}dB`)}}if(p.includes("showspectrum")){let h=p.match(/freq=(\d+)/);if(h){let C=parseFloat(h[1]);c.push(` Frequency: ${C}Hz
`)}}});let f=new Blob([c.join("")],{type:"text/plain"}),g=URL.createObjectURL(f),m=document.createElement("a");m.href=g,m.download="audio_analysis.txt",m.style.display="none",document.body.appendChild(m),m.click(),document.body.removeChild(m),ue.textContent="Conversion complete!",yield bt(c)}catch(a){ue.textContent="Error occurred during conversion.",console.error("FFmpeg error:",a)}}));function bt(t){return O(this,null,function*(){let i="";t.forEach(n=>{let a=n.match(/Frequency: (\d+)Hz/);if(a){let c=a[1];i+=`sine=${c}
`}});try{yield U.run("-f","lavfi","-i","sine=frequency=1000:duration=10","output.mp3");let n=U.FS("readFile","output.mp3"),a=new Blob([n.buffer],{type:"audio/mp3"}),c=URL.createObjectURL(a),f=document.createElement("a");f.href=c,f.download="generated_audio.mp3",f.textContent="Download Generated MP3",document.body.appendChild(f),f.click(),document.body.removeChild(f)}catch(n){console.error("MP3 generation error:",n)}})}});Et();})();
//# sourceMappingURL=main.js.map
