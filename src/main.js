"use strict";(()=>{var ze=Object.create;var X=Object.defineProperty;var Ve=Object.getOwnPropertyDescriptor;var Je=Object.getOwnPropertyNames,W=Object.getOwnPropertySymbols,Ze=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var me=(t,o,i)=>o in t?X(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i,H=(t,o)=>{for(var i in o||(o={}))ee.call(o,i)&&me(t,i,o[i]);if(W)for(var i of W(o))de.call(o,i)&&me(t,i,o[i]);return t};var ge=(t,o)=>{var i={};for(var a in t)ee.call(t,a)&&o.indexOf(a)<0&&(i[a]=t[a]);if(t!=null&&W)for(var a of W(t))o.indexOf(a)<0&&de.call(t,a)&&(i[a]=t[a]);return i};var j=(t,o)=>()=>(o||t((o={exports:{}}).exports,o),o.exports);var Ke=(t,o,i,a)=>{if(o&&typeof o=="object"||typeof o=="function")for(let l of Je(o))!ee.call(t,l)&&l!==i&&X(t,l,{get:()=>o[l],enumerable:!(a=Ve(o,l))||a.enumerable});return t};var Qe=(t,o,i)=>(i=t!=null?ze(Ze(t)):{},Ke(o||!t||!t.__esModule?X(i,"default",{value:t,enumerable:!0}):i,t));var q=(t,o,i)=>new Promise((a,l)=>{var f=d=>{try{m(i.next(d))}catch(g){l(g)}},w=d=>{try{m(i.throw(d))}catch(g){l(g)}},m=d=>d.done?a(d.value):Promise.resolve(d.value).then(f,w);m((i=i.apply(t,o)).next())});var ve=j((Et,re)=>{var te=function(t){"use strict";var o=Object.prototype,i=o.hasOwnProperty,a=Object.defineProperty||function(r,e,n){r[e]=n.value},l,f=typeof Symbol=="function"?Symbol:{},w=f.iterator||"@@iterator",m=f.asyncIterator||"@@asyncIterator",d=f.toStringTag||"@@toStringTag";function g(r,e,n){return Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),r[e]}try{g({},"")}catch(r){g=function(e,n,c){return e[n]=c}}function G(r,e,n,c){var s=e&&e.prototype instanceof R?e:R,u=Object.create(s.prototype),L=new Z(c||[]);return a(u,"_invoke",{value:He(r,n,L)}),u}t.wrap=G;function U(r,e,n){try{return{type:"normal",arg:r.call(e,n)}}catch(c){return{type:"throw",arg:c}}}var C="suspendedStart",P="suspendedYield",A="executing",B="completed",v={};function R(){}function _(){}function k(){}var h={};g(h,w,function(){return this});var p=Object.getPrototypeOf,y=p&&p(p(K([])));y&&y!==o&&i.call(y,w)&&(h=y);var b=k.prototype=R.prototype=Object.create(h);_.prototype=k,a(b,"constructor",{value:k,configurable:!0}),a(k,"constructor",{value:_,configurable:!0}),_.displayName=g(k,d,"GeneratorFunction");function S(r){["next","throw","return"].forEach(function(e){g(r,e,function(n){return this._invoke(e,n)})})}t.isGeneratorFunction=function(r){var e=typeof r=="function"&&r.constructor;return e?e===_||(e.displayName||e.name)==="GeneratorFunction":!1},t.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,k):(r.__proto__=k,g(r,d,"GeneratorFunction")),r.prototype=Object.create(b),r},t.awrap=function(r){return{__await:r}};function T(r,e){function n(u,L,E,O){var F=U(r[u],r,L);if(F.type==="throw")O(F.arg);else{var Q=F.arg,I=Q.value;return I&&typeof I=="object"&&i.call(I,"__await")?e.resolve(I.__await).then(function($){n("next",$,E,O)},function($){n("throw",$,E,O)}):e.resolve(I).then(function($){Q.value=$,E(Q)},function($){return n("throw",$,E,O)})}}var c;function s(u,L){function E(){return new e(function(O,F){n(u,L,O,F)})}return c=c?c.then(E,E):E()}a(this,"_invoke",{value:s})}S(T.prototype),g(T.prototype,m,function(){return this}),t.AsyncIterator=T,t.async=function(r,e,n,c,s){s===void 0&&(s=Promise);var u=new T(G(r,e,n,c),s);return t.isGeneratorFunction(e)?u:u.next().then(function(L){return L.done?L.value:u.next()})};function He(r,e,n){var c=C;return function(u,L){if(c===A)throw new Error("Generator is already running");if(c===B){if(u==="throw")throw L;return he()}for(n.method=u,n.arg=L;;){var E=n.delegate;if(E){var O=pe(E,n);if(O){if(O===v)continue;return O}}if(n.method==="next")n.sent=n._sent=n.arg;else if(n.method==="throw"){if(c===C)throw c=B,n.arg;n.dispatchException(n.arg)}else n.method==="return"&&n.abrupt("return",n.arg);c=A;var F=U(r,e,n);if(F.type==="normal"){if(c=n.done?B:P,F.arg===v)continue;return{value:F.arg,done:n.done}}else F.type==="throw"&&(c=B,n.method="throw",n.arg=F.arg)}}}function pe(r,e){var n=e.method,c=r.iterator[n];if(c===l)return e.delegate=null,n==="throw"&&r.iterator.return&&(e.method="return",e.arg=l,pe(r,e),e.method==="throw")||n!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var s=U(c,r.iterator,e.arg);if(s.type==="throw")return e.method="throw",e.arg=s.arg,e.delegate=null,v;var u=s.arg;if(!u)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,v;if(u.done)e[r.resultName]=u.value,e.next=r.nextLoc,e.method!=="return"&&(e.method="next",e.arg=l);else return u;return e.delegate=null,v}S(b),g(b,d,"Generator"),g(b,w,function(){return this}),g(b,"toString",function(){return"[object Generator]"});function Ye(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function J(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function Z(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(Ye,this),this.reset(!0)}t.keys=function(r){var e=Object(r),n=[];for(var c in e)n.push(c);return n.reverse(),function s(){for(;n.length;){var u=n.pop();if(u in e)return s.value=u,s.done=!1,s}return s.done=!0,s}};function K(r){if(r){var e=r[w];if(e)return e.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var n=-1,c=function s(){for(;++n<r.length;)if(i.call(r,n))return s.value=r[n],s.done=!1,s;return s.value=l,s.done=!0,s};return c.next=c}}return{next:he}}t.values=K;function he(){return{value:l,done:!0}}return Z.prototype={constructor:Z,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(J),!r)for(var e in this)e.charAt(0)==="t"&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var r=this.tryEntries[0],e=r.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var e=this;function n(O,F){return u.type="throw",u.arg=r,e.next=O,F&&(e.method="next",e.arg=l),!!F}for(var c=this.tryEntries.length-1;c>=0;--c){var s=this.tryEntries[c],u=s.completion;if(s.tryLoc==="root")return n("end");if(s.tryLoc<=this.prev){var L=i.call(s,"catchLoc"),E=i.call(s,"finallyLoc");if(L&&E){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(L){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else if(E){if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,e){for(var n=this.tryEntries.length-1;n>=0;--n){var c=this.tryEntries[n];if(c.tryLoc<=this.prev&&i.call(c,"finallyLoc")&&this.prev<c.finallyLoc){var s=c;break}}s&&(r==="break"||r==="continue")&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var u=s?s.completion:{};return u.type=r,u.arg=e,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(u)},complete:function(r,e){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&e&&(this.next=e),v},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===r)return this.complete(n.completion,n.afterLoc),J(n),v}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===r){var c=n.completion;if(c.type==="throw"){var s=c.arg;J(n)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(r,e,n){return this.delegate={iterator:K(r),resultName:e,nextLoc:n},this.method==="next"&&(this.arg=l),v}},t}(typeof re=="object"?re.exports:{});try{regeneratorRuntime=te}catch(t){typeof globalThis=="object"?globalThis.regeneratorRuntime=te:Function("r","regeneratorRuntime = r")(te)}});var ye=j((Ft,we)=>{we.exports={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}}});var oe=j((jt,Le)=>{var ne=!1,be=()=>{},Xe=t=>{ne=t},et=t=>{be=t},tt=(t,o)=>{be({type:t,message:o}),ne&&console.log(`[${t}] ${o}`)};Le.exports={logging:ne,setLogging:Xe,setCustomLogger:et,log:tt}});var je=j((Pt,Fe)=>{var M=0,ie=0,Ee=t=>{let[o,i,a]=t.split(":");return parseFloat(o)*60*60+parseFloat(i)*60+parseFloat(a)};Fe.exports=(t,o)=>{if(typeof t=="string")if(t.startsWith("  Duration")){let i=t.split(", ")[0].split(": ")[1],a=Ee(i);o({duration:a,ratio:ie}),(M===0||M>a)&&(M=a)}else if(t.startsWith("frame")||t.startsWith("size")){let i=t.split("time=")[1].split(" ")[0],a=Ee(i);ie=a/M,o({ratio:ie,time:a})}else t.startsWith("video:")&&(o({ratio:1}),M=0)}});var ke=j((kt,Pe)=>{Pe.exports=(t,o)=>{let i=t._malloc(o.length*Uint32Array.BYTES_PER_ELEMENT);return o.forEach((a,l)=>{let f=t._malloc(a.length+1);t.writeAsciiToMemory(a,f),t.setValue(i+Uint32Array.BYTES_PER_ELEMENT*l,f,"i32")}),[o.length,i]}});var Y=j((ae,Se)=>{(function(t,o){typeof define=="function"&&define.amd?define(o):typeof ae=="object"?Se.exports=o():t.resolveUrl=o()})(ae,function(){function t(){var o=arguments.length;if(o===0)throw new Error("resolveUrl requires at least one argument; got none.");var i=document.createElement("base");if(i.href=arguments[0],o===1)return i.href;var a=document.getElementsByTagName("head")[0];a.insertBefore(i,a.firstChild);for(var l=document.createElement("a"),f,w=1;w<o;w++)l.href=arguments[w],f=l.href,i.href=f;return a.removeChild(i),f}return t})});var se=j((St,rt)=>{rt.exports={name:"@ffmpeg/ffmpeg",version:"0.10.1",description:"FFmpeg WebAssembly version",main:"src/index.js",types:"src/index.d.ts",directories:{example:"examples"},scripts:{start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},browser:{"./src/node/index.js":"./src/browser/index.js"},repository:{type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},keywords:["ffmpeg","WebAssembly","video"],author:"Jerome Wu <jeromewus@gmail.com>",license:"MIT",bugs:{url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},engines:{node:">=12.16.1"},homepage:"https://github.com/ffmpegwasm/ffmpeg.wasm#readme",dependencies:{"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},devDependencies:{"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.10.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"}}});var Ce=j((Ct,Oe)=>{var Ot=Y(),{devDependencies:nt}=se();Oe.exports={corePath:`https://unpkg.com/@ffmpeg/core@${nt["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`}});var qe=j((ce,Re)=>{var ot=Y(),{log:D}=oe(),le=(t,o)=>q(ce,null,function*(){D("info",`fetch ${t}`);let i=yield(yield fetch(t)).arrayBuffer();D("info",`${t} file size = ${i.byteLength} bytes`);let a=new Blob([i],{type:o}),l=URL.createObjectURL(a);return D("info",`${t} blob URL = ${l}`),l});Re.exports=o=>q(ce,[o],function*({corePath:t}){if(typeof t!="string")throw Error("corePath should be a string!");let i=ot(t),a=yield le(i,"application/javascript"),l=yield le(i.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),f=yield le(i.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore=="undefined"?new Promise(w=>{let m=document.createElement("script"),d=()=>{m.removeEventListener("load",d),D("info","ffmpeg-core.js script loaded"),w({createFFmpegCore,corePath:a,wasmPath:l,workerPath:f})};m.src=a,m.type="text/javascript",m.addEventListener("load",d),document.getElementsByTagName("head")[0].appendChild(m)}):(D("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:a,wasmPath:l,workerPath:f}))})});var Te=j((Ue,_e)=>{var it=Y(),at=t=>new Promise((o,i)=>{let a=new FileReader;a.onload=()=>{o(a.result)},a.onerror=({target:{error:{code:l}}})=>{i(Error(`File could not be read! Code=${l}`))},a.readAsArrayBuffer(t)});_e.exports=t=>q(Ue,null,function*(){let o=t;return typeof t=="undefined"?new Uint8Array:(typeof t=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?o=atob(t.split(",")[1]).split("").map(i=>i.charCodeAt(0)):o=yield(yield fetch(it(t))).arrayBuffer():(t instanceof File||t instanceof Blob)&&(o=yield at(t)),new Uint8Array(o))})});var fe=j((Ut,Ae)=>{var st=Ce(),lt=qe(),ct=Te();Ae.exports={defaultOptions:st,getCreateFFmpegCore:lt,fetchFile:ct}});var xe=j((Ne,Ge)=>{var{defaultArgs:ft,baseOptions:ut}=ye(),{setLogging:Be,setCustomLogger:$e,log:N}=oe(),pt=je(),ht=ke(),{defaultOptions:mt,getCreateFFmpegCore:dt}=fe(),{version:gt}=se(),ue=Error("ffmpeg.wasm is not ready, make sure you have completed load().");Ge.exports=(t={})=>{let k=H(H(H({},ut),mt),t),{log:o,logger:i,progress:a}=k,l=ge(k,["log","logger","progress"]),f=null,w=null,m=null,d=!1,g=a,G=h=>{h==="FFMPEG_END"&&m!==null&&(m(),m=null,d=!1)},U=({type:h,message:p})=>{N(h,p),pt(p,g),G(p)},C=()=>q(Ne,null,function*(){if(N("info","load ffmpeg-core"),f===null){N("info","loading ffmpeg-core");let{createFFmpegCore:h,corePath:p,workerPath:y,wasmPath:b}=yield dt(l);f=yield h({mainScriptUrlOrBlob:p,printErr:S=>U({type:"fferr",message:S}),print:S=>U({type:"ffout",message:S}),locateFile:(S,T)=>{if(typeof window!="undefined"){if(typeof b!="undefined"&&S.endsWith("ffmpeg-core.wasm"))return b;if(typeof y!="undefined"&&S.endsWith("ffmpeg-core.worker.js"))return y}return T+S}}),w=f.cwrap("proxy_main","number",["number","number"]),N("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")}),P=()=>f!==null,A=(...h)=>{if(N("info",`run ffmpeg command: ${h.join(" ")}`),f===null)throw ue;if(d)throw Error("ffmpeg.wasm can only run one command at a time");return d=!0,new Promise(p=>{let y=[...ft,...h].filter(b=>b.length!==0);m=p,w(...ht(f,y))})},B=(h,...p)=>{if(N("info",`run FS.${h} ${p.map(y=>typeof y=="string"?y:`<${y.length} bytes binary file>`).join(" ")}`),f===null)throw ue;{let y=null;try{y=f.FS[h](...p)}catch(b){throw Error(h==="readdir"?`ffmpeg.FS('readdir', '${p[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:h==="readFile"?`ffmpeg.FS('readFile', '${p[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return y}},v=()=>{if(f===null)throw ue;d=!1,f.exit(1),f=null,w=null,m=null},R=h=>{g=h},_=h=>{$e(h)};return Be(o),$e(i),N("info",`use ffmpeg.wasm v${gt}`),{setProgress:R,setLogger:_,setLogging:Be,load:C,isLoaded:P,run:A,exit:v,FS:B}}});var Me=j((Tt,Ie)=>{ve();var vt=xe(),{fetchFile:wt}=fe();Ie.exports={createFFmpeg:vt,fetchFile:wt}});var bt=j(We=>{var V=Qe(Me()),x=(0,V.createFFmpeg)({log:!0}),De=document.getElementById("fileInput"),yt=document.getElementById("convertButton"),z=document.getElementById("output");yt.addEventListener("click",()=>q(We,null,function*(){var i;if(!((i=De.files)!=null&&i.length)){alert("Please select an MP3 file.");return}let t=De.files[0];z.textContent="Processing...",x.isLoaded()||(yield x.load()),x.FS("writeFile","input.mp3",yield(0,V.fetchFile)(t));let o="";x.setLogger(({type:a,message:l})=>{(a==="fferr"||a==="ffout")&&(o+=l+`
`)});try{yield x.run("-i","input.mp3","-filter_complex","showfreqs=s=320x180:mode=line","output_%d.png");let a=[],l=1;for(;;)try{let d=`output_${l}.png`,g=x.FS("readFile",d),G=new Blob([g.buffer],{type:"image/png"}),U=URL.createObjectURL(G),C=document.createElement("img");C.src=U,yield new Promise(p=>C.onload=p);let P=document.createElement("canvas"),A=P.getContext("2d");P.width=C.width,P.height=C.height,A.drawImage(C,0,0);let v=A.getImageData(0,0,P.width,P.height).data,R=0;for(let p=0;p<v.length;p+=4){let y=v[p],b=v[p+1],S=v[p+2],T=.299*y+.587*b+.114*S;R+=T}let _=l*(1e3/30),k=P.height/2*(R/v.length),h=R/(P.width*P.height);a.push(`Time: ${_}ms, Frequency: ${k}Hz, Volume: ${h}
`),l++}catch(d){break}let f=new Blob([a.join("")],{type:"text/plain"}),w=URL.createObjectURL(f),m=document.createElement("a");m.href=w,m.download="audio_analysis.txt",m.textContent="Download Analysis Results",z.appendChild(m),z.textContent="Conversion complete!"}catch(a){z.textContent="Error occurred during conversion.",console.error("FFmpeg error:",a),console.error("FFmpeg log:",o)}}))});bt();})();
//# sourceMappingURL=main.js.map
